---
layout: doc
title: Browser and Server Sync (Polling, Comet, Long Polling, WebSocket)
subtitle: 浏览器和服务器持续同步的方法介绍（Polling, Comet, Long Polling, WebSocket） 
categories: note
tags: nodejs javascript coffeescript python
---


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1 前言</a></li>
<li><a href="#sec-2">2 环境的搭建</a>
<ul>
<li><a href="#sec-2-1">2.1 Flask</a></li>
<li><a href="#sec-2-2">2.2 Nodejs</a></li>
</ul>
</li>
<li><a href="#sec-3">3 Polling</a></li>
<li><a href="#sec-4">4 Comet</a></li>
<li><a href="#sec-5">5 Long Polling</a></li>
<li><a href="#sec-6">6 WebSocket</a></li>
<li><a href="#sec-7">7 Socket.IO</a></li>
<li><a href="#sec-8">8 后记</a></li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1">前言</h2>
<div class="outline-text-2" id="text-1">

<p>这只是一篇简单介绍浏览器与服务器之间的实时数据交换的方法。
在客户端使用的是 <a href="http://coffeescript.org/">coffeescript</a> ，接触下来感觉这种语法还是不错的，
然后在学习的过程中，貌似coffeescript借鉴了许多 <a href="http://www.ruby-lang.org/en/">Ruby</a> 的语法，
所以接下来我准备去看看Ruby，当然这个是题外话啦。
一旦接受了coffeescript这种设定，还是很带感的。
</p>
<p>
然后服务器用的是 <a href="http://www.python.org/">python</a> 的 <a href="http://flask.pocoo.org/">Flask</a> 这一WEB框架以及 <a href="http://nodejs.org/">nodejs</a> 
</p>
<p>
主要参考的是：<a href="http://www.josephj.com/entry.php?id=358">Browser 與 Server 持續同步的作法介紹 (Polling, Comet, Long Polling, WebSocket)</a>
</p>
</div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2">环境的搭建</h2>
<div class="outline-text-2" id="text-2">


</div>

<div id="outline-container-2-1" class="outline-3">
<h3 id="sec-2-1">Flask</h3>
<div class="outline-text-3" id="text-2-1">

<ol>
<li>Install
     安装步骤，请移步 <a href="http://flask.pocoo.org/docs/installation/#installation">这里</a> ，这里是官方的安装方式，在这里我接触到了python的虚拟环境。
     感觉用这个virtualenv的确不错，然后我找到了一篇介绍这种的文章：<a href="https://virtualenv-chinese-docs.readthedocs.org/en/latest/">virtualenv</a>
</li>
<li>Quick Start
     请移步<a href="http://flask.pocoo.org/docs/quickstart/#quickstart">这里</a> 。我也是跟着快速教程一步一步做的，写出来的服务器也很简单。
     毕竟这篇文章的主题不是这个。
</li>
</ol>

</div>

</div>

<div id="outline-container-2-2" class="outline-3">
<h3 id="sec-2-2">Nodejs</h3>
<div class="outline-text-3" id="text-2-2">

<p>     关于如何安装 <a href="http://nodejs.org/">nodejs</a> 以及如何使用我在此不多累述。官方文档写的很详细。
     然后我使用的是 <a href="http://expressjs.com/">expressjs</a> 这一WEB框架。安装方式和快速入门点击 <a href="http://expressjs.com/guide.html">QuickStart</a> 。
</p>
<p>
     在这里着重写一下使用 <code>coffeescript</code> 来写nodejs的代码。
     具体可以看这篇文章：<a href="http://sparklinlabs.com/2013/06/my-node-js-express-coffeescript-setup/">My Node.js Express + CoffeeScript setup</a>
</p>
<p>
     我的做法只是用来其中的一条命令：
</p>


<pre class="example">$ sudo npm install -g js2coffee
</pre>

<p>
     将express生成的app.js转成了app.coffee，然后将 package.json 中的
</p>


<pre class="example">"start": "node app.js"
</pre>

<p>
     变成了：
</p>


<pre class="example">"start": "coffee app.coffee"
</pre>


<p>
     具体的在我上面提到文章中有详细介绍。当然还可以看看这个：<a href="http://twilson63.github.io/express-coffee/">Express-coffee</a>
</p>
</div>
</div>

</div>

<div id="outline-container-3" class="outline-2">
<h2 id="sec-3">Polling</h2>
<div class="outline-text-2" id="text-3">

<p>    这是轮询的方式，是一种很常见的解决方案。然后我这里没有写代码。
  思路就是使用setInterval()函数，定时访问服务器。构成一个一个polling.
</p>
</div>

</div>

<div id="outline-container-4" class="outline-2">
<h2 id="sec-4">Comet</h2>
<div class="outline-text-2" id="text-4">

<p>  等待填坑……
</p></div>

</div>

<div id="outline-container-5" class="outline-2">
<h2 id="sec-5">Long Polling</h2>
<div class="outline-text-2" id="text-5">

<p>    长轮询方式。
    代码：
    <script src="https://gist.github.com/creamidea/6114508.js"></script>

</p></div>

</div>

<div id="outline-container-6" class="outline-2">
<h2 id="sec-6">WebSocket</h2>
<div class="outline-text-2" id="text-6">

<p>  等待填坑……
</p>
</div>

</div>

<div id="outline-container-7" class="outline-2">
<h2 id="sec-7">Socket.IO</h2>
<div class="outline-text-2" id="text-7">

<p>    <a href="http://socket.io/">Socket.IO</a> 这个我个人感觉不错，支持的浏览器也很多，然后使用的是nodejs。
    有空的时候看看源代码，看看究竟是如何实现的。
</p>
<p>
    然后下面的代码都是按照官方的步骤做的，只是稍微修改了一下。具体的可以参照 <a href="http://socket.io/#how-to-use">这里</a>
</p>
<p>    
    代码：
    <script src="https://gist.github.com/creamidea/6114473.js"></script>

</p></div>

</div>

<div id="outline-container-8" class="outline-2">
<h2 id="sec-8">后记</h2>
<div class="outline-text-2" id="text-8">

<p>    然后接下来需要思考的是数据库更新，如何通知web服务器发送更新数据？
  继续等待填坑……
</p></div>
</div>
